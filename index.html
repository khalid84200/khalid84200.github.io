<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GMAO Pro X</title>
    <meta name="theme-color" content="#4A90E2"/>
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/96/maintenance.png">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22GMAO Pro X%22,%22short_name%22:%22GMAO%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#F4F7FC%22,%22theme_color%22:%22#4A90E2%22,%22icons%22:[{%22src%22:%22https://img.icons8.com/fluency/96/maintenance.png%22,%22sizes%22:%2296x96%22,%22type%22:%22image/png%22}]}">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="auth-container">
        <div class="auth-box">
            <form id="login-form">
                <h2><i class="fas fa-lock"></i> Connexion</h2>
                <div class="form-group"><input type="email" id="login-email" class="form-control" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="login-password" class="form-control" placeholder="Mot de passe" required></div>
                <button type="submit" class="btn btn-full">Se connecter</button>
                <p class="auth-error" id="login-error-msg"></p>
                <p class="auth-toggle-link" id="show-signup">Pas de compte ? S'inscrire</p>
            </form>
            <form id="signup-form">
                <h2><i class="fas fa-user-plus"></i> Inscription</h2>
                <div class="form-group"><input type="email" id="signup-email" class="form-control" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="signup-password" class="form-control" placeholder="Mot de passe (6+ caractères)" required></div>
                <button type="submit" class="btn btn-full">Créer un compte</button>
                <p class="auth-error" id="signup-error-msg"></p>
                <p class="auth-toggle-link" id="show-login">Déjà un compte ? Se connecter</p>
            </form>
        </div>
    </div>

    <div class="app-container">
        <header class="app-header">
            <h1><i class="fas fa-tools"></i> GMAO Pro X</h1>
            <div class="header-actions">
                <i class="fas fa-moon theme-switcher"></i>
                <i class="fab fa-whatsapp" id="whatsapp-btn" title="Communauté"></i>
                <i class="fas fa-sign-out-alt" id="logout-btn" title="Déconnexion"></i>
            </div>
        </header>
        <main class="page-container">
            <div class="page-content active" id="dashboard">
                <div class="card" id="test-data-card" style="display: none;">
                    <div class="section-title"><i class="fas fa-database"></i> Base de données vide</div>
                    <p style="color: var(--light-gray); margin-bottom: 15px;">Cliquez pour ajouter des données de démo.</p>
                    <button id="add-test-data-btn" class="btn btn-full">Ajouter Données de Test</button>
                </div>
                <div class="card">
                    <div class="section-title"><i class="fas fa-filter"></i> Filtrer</div>
                    <div class="date-filter-grid">
                        <div class="form-group" style="margin:0;"><label for="date-start">Début</label><input type="date" id="date-start" class="form-control"></div>
                        <div class="form-group" style="margin:0;"><label for="date-end">Fin</label><input type="date" id="date-end" class="form-control"></div>
                        <button id="filter-btn" class="btn"><i class="fas fa-check"></i> Appliquer</button>
                    </div>
                </div>
                <div class="card">
                    <div class="section-title"><i class="fas fa-tachometer-alt"></i> KPI</div>
                    <div class="kpi-grid-pro">
                        <div class="kpi-gauge-container">
                            <canvas id="availabilityChart"></canvas>
                            <div id="kpi-availability-value" class="kpi-gauge-value">--%</div>
                        </div>
                        <div class="kpi-column">
                            <div class="kpi-value" id="kpi-mttr">--</div>
                            <div class="kpi-label">MTTR</div>
                            <hr style="margin: 10px 0; border-color: var(--border-color);">
                            <div class="kpi-value" id="kpi-mtbf">--</div>
                            <div class="kpi-label">MTBF</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="section-title"><i class="fas fa-chart-bar"></i> Top 3 Machines (Temps d'arrêt)</div>
                    <canvas id="downtimeByEquipmentChart"></canvas>
                </div>
                <div class="card">
                    <div class="section-title"><i class="fas fa-history"></i> Interventions récentes</div>
                    <ul class="item-list" id="recent-interventions-list"><div class="loading-message">Chargement...</div></ul>
                </div>
            </div>
            <div class="page-content" id="equipments"><input type="text" class="search-bar" id="equipment-search" placeholder="Rechercher..."><ul class="item-list" id="equipments-list"><div class="loading-message">Chargement...</div></ul></div>
            <div class="page-content" id="interventions"><input type="text" class="search-bar" id="intervention-search" placeholder="Rechercher..."><div class="card"><div class="section-title"><i class="fas fa-filter"></i> Filtrer</div><div class="date-filter-grid"><div class="form-group" style="margin:0;"><label for="intervention-date-start">Début</label><input type="date" id="intervention-date-start" class="form-control"></div><div class="form-group" style="margin:0;"><label for="intervention-date-end">Fin</label><input type="date" id="intervention-date-end" class="form-control"></div></div></div><div class="card"><div class="section-title"><i class="fas fa-chart-pie"></i> Ratio</div><div class="chart-container"><canvas id="ratioChartCanvas"></canvas></div></div><ul class="item-list" id="interventions-list"><div class="loading-message">Chargement...</div></ul></div>
            <div class="page-content" id="parts"><input type="text" class="search-bar" id="part-search" placeholder="Rechercher..."><div class="card"><div class="section-title"><i class="fas fa-dollar-sign"></i> Valeur du Stock</div><h3 id="total-stock-value" style="text-align: center; color: var(--primary-color);">Calcul...</h3></div><div class="card"><div class="section-title"><i class="fas fa-filter"></i> Filtrer</div><div class="form-group"><label for="supplier-filter">Fournisseur</label><select id="supplier-filter" class="form-control"></select></div><div class="filter-toggle"><input type="checkbox" id="reorder-filter"><label for="reorder-filter">Afficher articles à commander</label></div></div><ul class="item-list" id="parts-list"><div class="loading-message">Chargement...</div></ul></div>
            <div class="page-content" id="technicians"><input type="text" class="search-bar" id="technician-search" placeholder="Rechercher..."><ul class="item-list" id="technicians-list"><div class="loading-message">Chargement...</div></ul></div>
        </main>
        <div class="fab" id="fab-add-button"><i class="fas fa-plus"></i></div>
        <nav class="bottom-nav"><a href="#dashboard" class="nav-item active"><i class="fas fa-home"></i><span>Accueil</span></a><a href="#equipments" class="nav-item"><i class="fas fa-cogs"></i><span>Équipements</span></a><a href="#interventions" class="nav-item"><i class="fas fa-wrench"></i><span>Interventions</span></a><a href="#parts" class="nav-item"><i class="fas fa-box-open"></i><span>Pièces</span><span class="notification-dot"></span></a><a href="#technicians" class="nav-item"><i class="fas fa-users"></i><span>Techniciens</span></a></nav>
        
        <div class="modal" id="formModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="modalTitle">Nouveau</h3><span class="close-modal">&times;</span></div><form id="mainForm"></form></div></div>
        <div class="modal" id="qrModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">QR Code</h3><span class="close-modal">&times;</span></div><div id="qrCodeContainer" style="text-align: center;"><p id="qrEquipmentName" style="margin-bottom: 15px; font-weight: 500;"></p><div id="qrCodeCanvas"></div></div></div></div>
        <div class="modal" id="statsModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="statsModalTitle">Statistiques</h3><span class="close-modal">&times;</span></div><div class="stats-modal-grid"><div class="stats-item"><div class="value" id="statsTotalTime">--</div><div class="label">Temps total</div></div><div class="stats-item"><div class="value" id="statsWorkload">--</div><div class="label">Charge</div></div></div></div></div>
        <div class="modal" id="equipmentDetailModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="equipmentDetailModalTitle">Détails</h3><span class="close-modal">&times;</span></div><div id="equipmentDetailContent"></div></div></div>
        <div class="modal" id="partDetailModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="partDetailModalTitle">Détails pièce</h3><span class="close-modal">&times;</span></div><div id="partDetailContent"></div></div></div>
        <div class="modal" id="whatsappModal"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Rejoindre la communauté</h3><span class="close-modal">&times;</span></div><div style="text-align: center; display: flex; flex-direction: column; gap: 15px;"><a href="https://chat.whatsapp.com/BNWATqvGwSIJ5a5jIZE80H" target="_blank" class="btn btn-full" style="background-color: #25D366;"><i class="fab fa-whatsapp"></i> Rejoindre le Groupe</a><a href="https://whatsapp.com/channel/0029Vb6TLcqEFeXjfGXHAe2v" target="_blank" class="btn btn-full" style="background-color: #25D366;"><i class="fas fa-bullhorn"></i> Suivre la Chaîne</a></div></div></div>
        <div class="modal" id="custom-alert-modal"><div class="modal-content"><h3 class="modal-title" id="custom-alert-title">Information</h3><p id="custom-alert-message" style="margin: 20px 0;"></p><div class="dialog-actions"><button id="custom-alert-ok" class="btn">OK</button></div></div></div>
        <div class="modal" id="custom-confirm-modal"><div class="modal-content"><h3 class="modal-title" id="custom-confirm-title">Confirmation</h3><p id="custom-confirm-message" style="margin: 20px 0;"></p><div class="dialog-actions"><button id="custom-confirm-cancel" class="btn btn-danger">Annuler</button><button id="custom-confirm-ok" class="btn">Confirmer</button></div></div></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    
    <script src="app.js?v=1.1" type="module"></script>
</body>
</html>
